#cloud-config
autoinstall:
  version: 1
  locale: en_US.UTF-8

  keyboard:
    layout: us

  ssh:
    install-server: true
    allow-pw: true

  identity:
    hostname: ubuntu24-golden
    username: ubuntu
    password: "$6$gXvGGLYtBfU1cvyO$pRaGMuhKRB1XUQKszal3NbVoIJhf6UBSP482005KLbvlkXiVEMGp9eiqV78E3R5gCqxDv1kzraD3q86kfeDIE/"

  user-data:
    disable_root: false
    chpasswd:
      expire: false
      list:
        - root:"$6$gXvGGLYtBfU1cvyO$pRaGMuhKRB1XUQKszal3NbVoIJhf6UBSP482005KLbvlkXiVEMGp9eiqV78E3R5gCqxDv1kzraD3q86kfeDIE/"

  storage:
    layout:
      name: lvm

  packages:
    - qemu-guest-agent
    - cloud-init
    - sudo
    - openssh-server

  late-commands:
    - curtin in-target --target=/target sed -i 's/^#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
    - curtin in-target --target=/target sed -i 's/^#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
    - curtin in-target --target=/target systemctl enable qemu-guest-agent
